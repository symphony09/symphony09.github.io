---
title: "NAS 折腾记"
date: 2021-07-26T19:29:41+08:00
categories:
- 折腾
tags:
- nas
- 硬件
cover: https://w.wallhaven.cc/full/43/wallhaven-43zkod.jpg
---

因为本人没多少money，加上喜欢折腾，所以并未采用现成的 NAS 方案，选择自己凑配硬件搭建。在21年初初步搭建完成，现在已经平稳运行半年左右，还算满意。现在得空分享一下搭建经验，供同好参考。

## 方案介绍

不同于常见的多盘位 NAS 机箱，我采用了迷你主机加硬盘盒的形式，通过网线连接路由器提供 NAS 服务。

其实市面上也有类似的方案，如雷克沙时光机。与多盘位机箱相比，这种方案的优点是占用空间小，可以轻松的的放进包里，硬盘也不会被限制在机器上。

有优点当然也有缺点，这种方案只适合轻量 NAS 。上面提到的雷克沙时光机仅有一个 USB 接口，在不考虑拓展坞的情况下只能连接一个硬盘。不过我并没有多么变态的容量需求，所以这一点没什么影响。

## 硬件

- NUC 5 PPYH  x 1，加上 4G DDR3 内存和 240G 固态硬盘共600元。

NUC 是英特尔推出的迷你主机准系统，因为是准系统，所以需要自购内存硬盘才能跑起来。CPU 为 奔腾 4 核处理器，1.6~2.4GHZ， TDP 只有6w，适合长期运行。

接口方面，有4个USB3.0，一个HDMI和DP，一个千兆网口，还有3.5mm音频接口。

这个机子本来是作为普通电脑使用的，顺便作为NAS设备使用完全够用。

- 西数紫盘 2T x 1，加上硬盘盒共430元。

硬盘没啥好说的，避开叠瓦盘盘然后选个容量适合就OK。硬盘盒就看支不支持USB3.0和自动休眠，材质的话金属散热好点。

## 软件

### 系统

Windows 是不可能用 Windows 的，一开始我看同事在用 openSUSE ，所以也装了个尝尝鲜。总体使用体验还是可以的，YaST 工具非常好用。只可惜社区基本凉凉，搜到的文章资料又少又老。

后来换了Manjaro，基于大名鼎鼎的 Arch Linux，使用体验非常好，软件包又全又新。比如 docker、hugo（静态网站生成器） 可以直接用 pacman 命令安装，go 版本基本与官网保持同步。中间出过重启会卡住的问题，将内核版本降到5.4就OK了。

### 应用

- docker，运行各种应用
- portainer，docker 管理
- samba，网络共享挂载的磁盘
- netdata，监控机器运行状态
- aria2+AriaNg、qbittorroent-nox，文件下载
- cloudreve、filebrowser、syncthing，云盘，文件同步
- emby，音视频播放
- hugo、hexo，个人博客
- nginx，部署简单的导航页
- 各种小玩意，minikube等

### 配置

基本就是网络配置（固定ip，防火墙），各种软件的安装配置，以及编写 systemd service 开机启动，fstab挂载磁盘。fstab挂载磁盘要小心，建议先试一下，直接重启并且无法挂载磁盘会导致系统进不去，这时就需要进救援模式修复了（亲身经历）。

详细的以后有空再开篇分享吧，这里先挖个坑。

## 总结

事实上，这个方案确实算不上正经的 NAS，尤其还缺少云同步的功能。但是好在什么都能干，在局域网内跨设备共享文件，也基本满足了我的要求。速度在110MB/s左右，瓶颈在于网络带宽，如果更换为万兆网卡应该可以提升一点速度，但是不多，接口和磁盘（SATA、USB3.0、机械硬盘）会成为新的瓶颈。

