---
title: "TCP：序列号与滑动窗口"
date: 2021-04-20T21:40:26+08:00
categories:
- 学习笔记
- 网络
tags:
- tcp
keywords:
- tcp
- 序列号
- 滑动窗口
comments: false
#thumbnailImage: //example.com/image.jpg
summary: tcp最重要的特征就是面向连接和可靠，本文尝试用比较容易理解的方式讲解tcp是怎么做到可靠传输的。
---

<!--more-->

### 序列号的作用

上一篇博客中提到了序列号在建立tcp连接中的作用。不光如此，序列号还是tcp可靠传输的基础。

为了可靠传输就要防止丢包，所以接受端需要向发送端确认，就像我们收到快递包裹也要确认收货。类比来讲，序列号就像是快递单号。

但是与现实不同的是，tcp包数量庞大。这就造成：

- 单个单个确认会**浪费网络资源**
- 发送端在等待确认时无事可做会**浪费时间和硬件资源**

所以最好批量发送和确认，发送端一次性发送一组tcp包，接受端一次性确认一组tcp包。

### 怎么一次性确认多个包

很简单，序列号设计为连续的，确认顺序最靠后的包就代表收到了之前所有的包。考虑到可能出现丢包，如果收到如下一组包（数字代表包的序列号）：

{... ...，233，234，235，237，238}

此时为了保证收到缺失的包应确认235，而237，238都会当做没收到，这样发送端就会再次发送235之后的包。为了保证可靠性，这么做是值得的。

实际中确认报文（ACK）发送的序列号要加1，表示从这个序列号的包开始发送。

### 滑动窗口的作用

在批量发包时，一次性发多少数量是个问题，滑动窗口就代表这个数量。由于主要需要考虑接受端的能力，所以由接收端发送给发送端（两端间会往来数据，这里指广义上的数据接受端和发送端）。

发送端收到窗口大小后，就会计算发了多少包，剩余多少容量以保证保证不超过窗口大小，直到窗口更新。

### 发送的时机

将窗口更新和ACK报文合并发送可以提高网络效率。

