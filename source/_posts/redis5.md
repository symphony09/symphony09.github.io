---
title: "Redis（五）：整数集合"
date: 2021-03-12T21:47:30+08:00
categories:
- 学习笔记
- Redis
tags:
- Redis数据结构与对象
keywords:
- redis
- 整数集合
comments: false
#thumbnailImage: images/host/redis/redis-icon-logo.png
summary: 整数集合（intset）是集合键的底层实现之一，当一个集合只包含整数值元素，并且这个集合的元素数量不多时，Redis就会使用整数集合作为集合键的底层实现。本文分析了整数集合的实现和特点。
---

<!--more-->

整数集合（intset）是Redis用于保存整数值的集合抽象数据结构，它可以保存类型为int16_t、int32_t或者int64_t的整数值，并且保证集合中不会出现重复元素。

**整数集合结构示意图**

![整数集合结构示意图](/images/host/redis/redis-intset.jpg)



- `encoding`属性的值表示底层数组的整数类型。
- `length`属性的值表示数组的长度。
- `contents`就是底层整数数组。



redis支持将不同类型的整数添加到整数数组中，但是不同类型的整数所占空间不同，这意味着需要额外的操作。

当新元素的类型比整数集合现有所有元素的类型都要长时，需要升级操作。

##### 升级操作

1. 根据新元素的类型，扩展整数集合底层数组的空间大小，并为新元素分配空间。

2. 将底层数组现有的所有元素都转换成与新元素相同的类型，并将类型转换后的元素放置到正确的位上，而且在放置元素的过程中，需要继续维持底层数组的有序性质不变。从末尾开始搬可以避免位置冲突。

3. 将新元素添加到底层数组里面。

因为引发升级的新元素的长度总是比整数集合现有所有元素的长度都大，所以这个新元素的值要么就大于所有现有元素而被放在末尾，要么就小于所有现有元素而被放在开头。

 

通过升级操作，整数集合在具备灵活性的同时还能节约内存。要注意的是没有相对应的降级操作。



##### 总结

整数集合比较简单，要注意的是超出长度的的整数类型时引起的升级操作。





